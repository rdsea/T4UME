# T4UME
## Introduction
IoT Cloud CPS are CPS implemented on top of two technological pillars, i.e., Internet of Things and Cloud computing.

By uncertainty we mean here the lack of certainty (i.e., knowledge) about the timing and nature of inputs, 
the state of a system, a future outcome, as well as other relevant factors (see http://www.u-test.eu/).

Uncertainty Modeling and Evaluation (UME) is a model-driven methodology that aims at detecting uncertainty caused by missing information on UML Models representing IoT Cloud CPSs. It provides modeling guidelines and ad-hoc UML profiles to represent (i) IoT and Cloud structural elements and (ii) uncertainties as defined in U-Test (https://www.simula.no/file/d12pdf/download).

In particular, UME aims at detecting uncertainty at design-time, caused by "missing information", i.e., missing values for properties of applied stereotypes defined in U-Test profiles.

Figure 1 gives a bird-eye view of UME 

![N|Solid](https://github.com/rdsea/T4UME/blob/master/documents/images/UME.png)
Figure 1: the UME methodology.

Our Tool for Uncertainty Modeling and Evaluation (T4UME) supports the Uncertainty Modeling and Evaluation (UME) methodology.

T4UME implements the following capabilities
-	U-Detection: model validation that detects potential uncertainties caused by missing information in stereotype applications.
-	U-Refactoring: model refactoring that suitably modifies the UML Model depending on the detected uncertainty
-	T4UME Adaptation: higher-order transformation that automatically adapts T4UME to detect new sources of potential uncertainties caused by changes in applied UML profiles. New executable detection and refactoring routines are generated if changes happen in the definition of applied UML profiles
-	UML2JSON: model to text transformation that serialize part of the UML model (.uml) in JSON (.json) to reuse the model content for further engineering activities (e.g., IoT and cloud infrastructure provisioning and deployment).

T4UME is implemented in Eclipse EPSILON (https://www.eclipse.org/epsilon/). It can be integrated with UML editors that are built on top of Eclipse Modeling Framework (EMF, https://www.eclipse.org/modeling/emf/) like Papyrus (https://www.eclipse.org/papyrus/) and Rational Software Architect (RSA, http://www-03.ibm.com/software/products/it/ratsadesigner).

T4UME is a tool for model-driven engineering built following model-driven engineering principles.
In particular, Figure 2 shows a recurrent design pattern for model-driven engineering tasks.
U-Detection, U-Refactoring, and T4UME Adaptation are implemented by instantiating this design pattern on top of EPSILON.


<img src="https://github.com/rdsea/T4UME/blob/master/documents/images/pattern.png" style="width: 800px;"/>
</br>
Figure 2: Generic pattern for model-driven engineering task.
</br>

Further information can be found in the following presentations links:
-	https://www.researchgate.net/project/Testing-uncertainties-for-CPS-IoT
-	https://www.slideshare.net/berardinelli/uncertaintywise-engineering-of-iot-cloud-systems
-	https://www.slideshare.net/berardinelli/combining-modeldriven-engineering-and-elastic-execution-for-testing-uncertainty-in-cps


## U-Detection and U-Refactoring
U-Detection detects potential uncertainties within the UML model representing the IoT Cloud CPS under study.
U-Refactoring modifies the UML model representing the IoT Cloud CPS under study depending on the detected uncertainties.
This step is meant to be customized for different model-driven engineering processes. 
For example, we customized the U-Refactoring to be used in U-Test. Therefore, the refactoring actions create new UML StateMachines from which test cases can be generated by ad-hoc model to text transformations.

Figure 3 shows a Papyrus screenshot where potential uncertainties caused by missing information in properties of applied stereotypes can represent potential sources of uncertainties.

Figure 4 shows a Papyrus screenshot of the generated model elements after the execution of the refactoring action.


<img src="https://github.com/rdsea/T4UME/blob/master/documents/images/udetection.png" style="width: 800px;"/>
</br>
Figure 3: U-Detection example.
</br>


<img src="https://github.com/rdsea/T4UME/blob/master/documents/images/urefactoring.png" style="width: 800px;"/>
</br>
Figure 4: U-Refactoring example.
</br>

Figure 5 shows the detailed design of the U-Detection and U-Refactoring steps combined as instantiation of the generic design pattern in Figure 2.

<img src="https://github.com/rdsea/T4UME/blob/master/documents/images/pattern_udetection_urefactoring.png" style="width: 800px;"/>
</br>
Figure 5: Design of U-Detection and U-Refactoring steps.
</br>

## T4UME Adaptation
It is an higher-order transformation that automatically adapts T4UME to detect new sources of potential uncertainties caused by changes in applied UML profiles. New executable detection and refactoring routines are generated if changes happen in the definition of applied UML profiles

Figure 6 shows the detailed design of the T4UME Adaptation step as instantiation of the generic design pattern in Figure 2.


<img src="https://github.com/rdsea/T4UME/blob/master/documents/images/pattern_adaptation.png" style="width: 800px;"/>
</br>
Figure 6: Design of T4UME Adapdation step.
</br>

## UML2JSON 
T4UME includes a two-step UML2JSON - JSON2Java transformation engine.
The design rationales of the UML2JSON Step are 
- full control on UML2JSON transformation rules
- generation of POJO Java classes to instantiate runtime objects with a simple structure to obtain an easy-to-read serialization in JSON.

Figure 7 shows the detailed design of the UML2JSON step as instantiation of the generic design pattern in Figure 2.

<img src="https://github.com/rdsea/T4UME/blob/master/documents/images/pattern_uml2json.png" style="width: 800px;"/>
</br>
Figure 7: Design of UML2JSON.
</br>

UML2JSON generates a JAVA source code and APIs (UML2Java step) that import the Google GSON library. 
The resulting Java program can be executed and generates a JSON representation of the input UML Model in the IDE console.

In particular, UML2JSON transforms UML Classes and InstanceSpecifications into JSON. 
The tool ia designed to work with UML and to adapt to different domains brought by applied UML Profiles.
Indeed, UML2JSON is capable to read stereotypes applied to Classes and InstanceSpecifications model elements so that domain-specific information introduced via applied UML Profiles are also extracted. 

This work is partially funded by the H2020 Project U-Test http://www.u-test.eu/.
U-Test aims at enabling Model-Based Testing (MBT) of IoT Cloud Cyber-Physical Systems under uncertainty.

We are currently developing and adopting T4UME to satisfy the needs of U-Test. 

Further details:

**Intended Purpose of T4UME in UTest**
Generate JSON representation of an input UML Model that representa an IoT Cloud Cyber-Physical System.

*Input (manual)*
-	UML Model serialized in Eclipse UML (.uml)
-	UML Profile(s). Currently, we are testing T4UME with the following profiles: UML IoT Cloud Profile, Infrastructure Uncertainty Profile Cloud/IoT. See http://www.u-test.eu/ for further details.

*Intermediate Output (generated)*
-	Java Program 
-	Profile-Driven Java API to access UML representation of IoT Cloud resources (i.e., annotated UML Classes and UML InstanceSpecification model elements).
-	Google GSON, a Java serialization/deserialization library to convert Java Objects into JSON and back.
-	Java Main Program that instantiates Java Objects corresponding to UML Classes and UML InstanceSpecifications, invokes GSON, and generate JSON output

*Output (generated)*
-	JSON representation of IoT Cloud resource types (from UML Classes) and instances (from UML InstanceSpecification). Thanks to **Google GSON Library**, the runtime objects are correctly serialized in JSON.

Alternative existing solution is EMF2JSON (https://github.com/emfjson/emfjson-jackson), which serializes any kind of EMF-based Java Objects. However, it generates a more complex JSON structure without explicit customization capabilities.

## Contact
 The work is supported by H2020 U-test Project. License of the work is described in the license file. Contact Hong-Linh Truong hong-linh.truong@tuwien.ac.at for further information about U-Test in TU Wien and for further inquiry for using the code in commercial and education purpose. 

For technical work, contact:

Luca Berardinelli 
luca.berardinelli@tuwien.ac.at
https://www.linkedin.com/in/lucaberardinelli/

Hong-Linh Truong
hong-linh.truong@tuwien.ac.at
http://www.infosys.tuwien.ac.at/staff/truong
