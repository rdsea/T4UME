/*
__author__ = "TU Wien, Distributed System's Group", http://dsg.tuwien.ac.at/
__copyright__ = "Copyright 2017, TU Wien, Distributed Systems Group"
__license__   = EULA currently in development. Current terms of usage below.
__license_body__ We grant the right to use this software and create derivative work based on it for all non-commercial non-profit education purposes. 
__license_body__ For any commercial-related or profit-related usage of this software please contact 
__license_body__ Hong-Linh Truong truong@dsg.tuwien.ac.at
__license_body__ 
__license_body__ Warranty:
__license_body__ The software is provided "AS IS", without warranty of any kind, express or implied,
__license_body__ including but not limited to the warranties of merchantability, fitness for a
__license_body__ particular purpose and noninfringement. in no event shall the authors or copyright
__license_body__ holders be liable for any claim, damages or other liability, whether in an action of
__license_body__ contract, tort or otherwise, arising from, out of or in connection with the software or
__license_body__ the use or other dealings in the software.
__maintainer__ = "Luca Berardinelli"
__email__ = "luca.berardinelli@tuwien.ac.at"
__social__ = "https://www.linkedin.com/in/lucaberardinelli/"
*/


/*
Autogenerated Uncertainty Detection Rule (UDR).
The UDR aims at detecting potential infrastructural uncertainties caused by missing
information on UML Model.

This rule check the following stereotype: 
InfrastructureCPSProfile::InfrastructureInterface. 

InfrastructureInterface defines the following properties:
-	InfrastructureCPSProfile::InfrastructureInterface::applicationInterface
-	InfrastructureCPSProfile::InfrastructureInterface::integrationInterface
*/
//libraries
import "../../../../../../../eol/library/gen/profiles/InfrastructureUncertaintyProfile.eol";
import "../../../../../../../eol/library/gen/profiles/InfrastructureCPSProfile.eol";
import "../../../../../../../eol/library/gen/profiles/InternalUProfileLibrary.eol";
import "../../../../../../../eol/library/gen/profiles/CoreProfile.eol";
import "../../../../../../../eol/library/gen/urefactoring/URefactoringLibrary.eol";

pre {
var plugin : new Native("at.ac.tuwien.dsg.T4UME");
var UMLUtil = plugin.getUMLUtil();
var ModelerAgent = plugin.getModelerAgent();
var infrastructureUncertaintyProfile = Profile.all.selectOne(e|e.name = "InfrastructureUncertaintyProfile");
var infrastructureCPSProfile = Profile.all.selectOne(e|e.name = "InfrastructureCPSProfile");
var internalUProfileLibrary = Profile.all.selectOne(e|e.name = "InternalUProfileLibrary");
var coreProfile = Profile.all.selectOne(e|e.name = "CoreProfile");

}

context InfrastructureInterface {
	
	critique applicationInterface_Specification {
	
		guard {
			var condition = self.applicationInterface.isKindOf(Collection);
			return condition;
		}
		
		check {
			var baseElement = UMLUtil.getBaseElement(self);
			return not self.applicationInterface.isEmpty();
		}
		
		message: "Missing applicationInterface on InfrastructureInterface applied to "+ baseElement.getQualifiedName()		
		fix {
			title : "Generate ExecutionEnvironmentUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createExecutionEnvironmentUncertaintyStateMachine();
					var executionEnvironmentUncertainty = coreProfile.getExecutionEnvironmentUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(executionEnvironmentUncertainty) 
						and not (baseElement.isStereotypeApplied(executionEnvironmentUncertainty))){
						baseElement.applyStereotype(executionEnvironmentUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate StorageUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createStorageUncertaintyStateMachine();
					var storageUncertainty = coreProfile.getStorageUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(storageUncertainty) 
						and not (baseElement.isStereotypeApplied(storageUncertainty))){
						baseElement.applyStereotype(storageUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate ElasticityUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createElasticityUncertaintyStateMachine();
					var elasticityUncertainty = coreProfile.getElasticityUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(elasticityUncertainty) 
						and not (baseElement.isStereotypeApplied(elasticityUncertainty))){
						baseElement.applyStereotype(elasticityUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate ActuationUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createActuationUncertaintyStateMachine();
					var actuationUncertainty = coreProfile.getActuationUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(actuationUncertainty) 
						and not (baseElement.isStereotypeApplied(actuationUncertainty))){
						baseElement.applyStereotype(actuationUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate DataDeliveryUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createDataDeliveryUncertaintyStateMachine();
					var dataDeliveryUncertainty = coreProfile.getDataDeliveryUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(dataDeliveryUncertainty) 
						and not (baseElement.isStereotypeApplied(dataDeliveryUncertainty))){
						baseElement.applyStereotype(dataDeliveryUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate GovernanceUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createGovernanceUncertaintyStateMachine();
					var governanceUncertainty = coreProfile.getGovernanceUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(governanceUncertainty) 
						and not (baseElement.isStereotypeApplied(governanceUncertainty))){
						baseElement.applyStereotype(governanceUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate UncertaintyFamily State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createUncertaintyFamilyStateMachine();
					var uncertaintyFamily = coreProfile.getUncertaintyFamilyStereotype();
					
					if(baseElement.isStereotypeApplicable(uncertaintyFamily) 
						and not (baseElement.isStereotypeApplied(uncertaintyFamily))){
						baseElement.applyStereotype(uncertaintyFamily);
					}

				}
			}
		}
		
	}

	critique applicationInterfaceSpecification {
	
		guard {
			var condition = not self.applicationInterface.isKindOf(Collection);
			return condition;
		} 
		
		check {
			var baseElement = UMLUtil.getBaseElement(self);
			return not self.applicationInterface.isEmpty();
		}		
		message: "Constraint applicationInterfaceIsDefined failed on InfrastructureInterface "+ baseElement.getName() +". It causes this uncertainty bla bla bla"		
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createExecutionEnvironmentUncertaintyStateMachine();
					var executionEnvironmentUncertainty = coreProfile.getExecutionEnvironmentUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(executionEnvironmentUncertainty) 
						and not (baseElement.isStereotypeApplied(executionEnvironmentUncertainty))){
						baseElement.applyStereotype(executionEnvironmentUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createStorageUncertaintyStateMachine();
					var storageUncertainty = coreProfile.getStorageUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(storageUncertainty) 
						and not (baseElement.isStereotypeApplied(storageUncertainty))){
						baseElement.applyStereotype(storageUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createElasticityUncertaintyStateMachine();
					var elasticityUncertainty = coreProfile.getElasticityUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(elasticityUncertainty) 
						and not (baseElement.isStereotypeApplied(elasticityUncertainty))){
						baseElement.applyStereotype(elasticityUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createActuationUncertaintyStateMachine();
					var actuationUncertainty = coreProfile.getActuationUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(actuationUncertainty) 
						and not (baseElement.isStereotypeApplied(actuationUncertainty))){
						baseElement.applyStereotype(actuationUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createDataDeliveryUncertaintyStateMachine();
					var dataDeliveryUncertainty = coreProfile.getDataDeliveryUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(dataDeliveryUncertainty) 
						and not (baseElement.isStereotypeApplied(dataDeliveryUncertainty))){
						baseElement.applyStereotype(dataDeliveryUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createGovernanceUncertaintyStateMachine();
					var governanceUncertainty = coreProfile.getGovernanceUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(governanceUncertainty) 
						and not (baseElement.isStereotypeApplied(governanceUncertainty))){
						baseElement.applyStereotype(governanceUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createUncertaintyFamilyStateMachine();
					var uncertaintyFamily = coreProfile.getUncertaintyFamilyStereotype();
					
					if(baseElement.isStereotypeApplicable(uncertaintyFamily) 
						and not (baseElement.isStereotypeApplied(uncertaintyFamily))){
						baseElement.applyStereotype(uncertaintyFamily);
					}
				}
			}
		}
	}
	
	critique integrationInterface_Specification {
	
		guard {
			var condition = self.integrationInterface.isKindOf(Collection);
			return condition;
		}
		
		check {
			var baseElement = UMLUtil.getBaseElement(self);
			return not self.integrationInterface.isEmpty();
		}
		
		message: "Missing integrationInterface on InfrastructureInterface applied to "+ baseElement.getQualifiedName()		
		fix {
			title : "Generate ExecutionEnvironmentUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createExecutionEnvironmentUncertaintyStateMachine();
					var executionEnvironmentUncertainty = coreProfile.getExecutionEnvironmentUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(executionEnvironmentUncertainty) 
						and not (baseElement.isStereotypeApplied(executionEnvironmentUncertainty))){
						baseElement.applyStereotype(executionEnvironmentUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate StorageUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createStorageUncertaintyStateMachine();
					var storageUncertainty = coreProfile.getStorageUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(storageUncertainty) 
						and not (baseElement.isStereotypeApplied(storageUncertainty))){
						baseElement.applyStereotype(storageUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate ElasticityUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createElasticityUncertaintyStateMachine();
					var elasticityUncertainty = coreProfile.getElasticityUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(elasticityUncertainty) 
						and not (baseElement.isStereotypeApplied(elasticityUncertainty))){
						baseElement.applyStereotype(elasticityUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate ActuationUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createActuationUncertaintyStateMachine();
					var actuationUncertainty = coreProfile.getActuationUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(actuationUncertainty) 
						and not (baseElement.isStereotypeApplied(actuationUncertainty))){
						baseElement.applyStereotype(actuationUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate DataDeliveryUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createDataDeliveryUncertaintyStateMachine();
					var dataDeliveryUncertainty = coreProfile.getDataDeliveryUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(dataDeliveryUncertainty) 
						and not (baseElement.isStereotypeApplied(dataDeliveryUncertainty))){
						baseElement.applyStereotype(dataDeliveryUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate GovernanceUncertainty State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createGovernanceUncertaintyStateMachine();
					var governanceUncertainty = coreProfile.getGovernanceUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(governanceUncertainty) 
						and not (baseElement.isStereotypeApplied(governanceUncertainty))){
						baseElement.applyStereotype(governanceUncertainty);
					}

				}
			}
		}
		fix {
			title : "Generate UncertaintyFamily State in " + baseElement.getQualifiedName()
			do {
				transaction {
					//check if the behaviored classifier defines a state machine or not
					var owned_behaviors = baseElement.getOwnedBehaviors();
					
					/*
					var owned_statemachines = owned_behaviors.select(e|e.type.getName()="StateMachine");
					if(not (owned_statemachines.isEmpty()) ){
						UserInput.inform(baseElement.name + "contains " + owned_statemachines.size().asString() + "state machine(s)");
					}
					*/
					baseElement.createUncertaintyFamilyStateMachine();
					var uncertaintyFamily = coreProfile.getUncertaintyFamilyStereotype();
					
					if(baseElement.isStereotypeApplicable(uncertaintyFamily) 
						and not (baseElement.isStereotypeApplied(uncertaintyFamily))){
						baseElement.applyStereotype(uncertaintyFamily);
					}

				}
			}
		}
		
	}

	critique integrationInterfaceSpecification {
	
		guard {
			var condition = not self.integrationInterface.isKindOf(Collection);
			return condition;
		} 
		
		check {
			var baseElement = UMLUtil.getBaseElement(self);
			return not self.integrationInterface.isEmpty();
		}		
		message: "Constraint integrationInterfaceIsDefined failed on InfrastructureInterface "+ baseElement.getName() +". It causes this uncertainty bla bla bla"		
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createExecutionEnvironmentUncertaintyStateMachine();
					var executionEnvironmentUncertainty = coreProfile.getExecutionEnvironmentUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(executionEnvironmentUncertainty) 
						and not (baseElement.isStereotypeApplied(executionEnvironmentUncertainty))){
						baseElement.applyStereotype(executionEnvironmentUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createStorageUncertaintyStateMachine();
					var storageUncertainty = coreProfile.getStorageUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(storageUncertainty) 
						and not (baseElement.isStereotypeApplied(storageUncertainty))){
						baseElement.applyStereotype(storageUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createElasticityUncertaintyStateMachine();
					var elasticityUncertainty = coreProfile.getElasticityUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(elasticityUncertainty) 
						and not (baseElement.isStereotypeApplied(elasticityUncertainty))){
						baseElement.applyStereotype(elasticityUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createActuationUncertaintyStateMachine();
					var actuationUncertainty = coreProfile.getActuationUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(actuationUncertainty) 
						and not (baseElement.isStereotypeApplied(actuationUncertainty))){
						baseElement.applyStereotype(actuationUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createDataDeliveryUncertaintyStateMachine();
					var dataDeliveryUncertainty = coreProfile.getDataDeliveryUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(dataDeliveryUncertainty) 
						and not (baseElement.isStereotypeApplied(dataDeliveryUncertainty))){
						baseElement.applyStereotype(dataDeliveryUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createGovernanceUncertaintyStateMachine();
					var governanceUncertainty = coreProfile.getGovernanceUncertaintyStereotype();
					
					if(baseElement.isStereotypeApplicable(governanceUncertainty) 
						and not (baseElement.isStereotypeApplied(governanceUncertainty))){
						baseElement.applyStereotype(governanceUncertainty);
					}
				}
			}
		}
		fix {
			title : "Create Infrastructure Uncertainty State to " + baseElement.getName()
			do {
				transaction {
					baseElement.createUncertaintyFamilyStateMachine();
					var uncertaintyFamily = coreProfile.getUncertaintyFamilyStereotype();
					
					if(baseElement.isStereotypeApplicable(uncertaintyFamily) 
						and not (baseElement.isStereotypeApplied(uncertaintyFamily))){
						baseElement.applyStereotype(uncertaintyFamily);
					}
				}
			}
		}
	}
	
}

	

